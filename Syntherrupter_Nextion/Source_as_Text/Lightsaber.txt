Page Lightsaber
    Events
        Preinitialize Event
            // Prevent page refreshs until postinit
            ref_stop
            //
            // Load colors
            click fLoadColors,1
            //
            // Display username
            if(User_Settings.userNum.val==0)
            {
                tUser.txt=" "+User_Settings.u0Name.txt
            }else if(User_Settings.userNum.val==1)
            {
                tUser.txt=" "+User_Settings.u1Name.txt
            }else if(User_Settings.userNum.val==2)
            {
                tUser.txt=" "+User_Settings.u2Name.txt
            }
            //
            // Entered Lightsaber Mode. Lightsaber Mode is now active
            Settings.activeModes.val=Settings.activeModes.val|4
            //
            // Display all active modes
            sys0=Settings.activeModes.val&1
            if(sys0!=0)
            {
                // Simple Mode is active
                tMSI.bco=6900
            }
            sys0=Settings.activeModes.val&2
            if(sys0!=0)
            {
                // MIDI Live Mode is active
                tMML.bco=6900
            }
            sys0=Settings.activeModes.val&4
            if(sys0!=0)
            {
                // Lightsaber Mode is active
                tMLS.bco=6900
            }
            //
            tmLSButtonHold.tim=Other_Settings.nHoldTime.val
            tmReturn.tim=Other_Settings.nHoldTime.val
            // Default update mode is on release.
            vis bModeImmediate,0
            vis bModeManual,0
            vis bApply,0
            vis bModeRelease,1
            sMode.txt=bModeRelease.txt
            // Functions shall be invisible
            vis fSqrt,0
            vis fSlider,0
            // Hide buttons for unavailable tesla coils
            if(TC_Settings.maxCoilCount.val<6)
            {
                vis btCoil6,0
                vis nOn6,0
                vis tus6,0
                vis tLS6,0
            }
            if(TC_Settings.maxCoilCount.val<5)
            {
                vis btCoil5,0
                vis nOn5,0
                vis tus5,0
                vis tLS5,0
            }
            if(TC_Settings.maxCoilCount.val<4)
            {
                vis btCoil4,0
                vis nOn4,0
                vis tus4,0
                vis tLS4,0
            }
            if(TC_Settings.maxCoilCount.val<3)
            {
                vis btCoil3,0
                vis nOn3,0
                vis tus3,0
                vis tLS3,0
            }
            if(TC_Settings.maxCoilCount.val<2)
            {
                // Single Coil Mode. No need to show a select option.
                vis btCoil2,0
                vis nOn2,0
                vis tus2,0
                vis tLS2,0
                vis btCoil1,0
                vis nOn1,0
                vis tus1,0
                vis tLS1,0
                vis tCoil,0
                // Make sure that the coil is active.
                btCoil1.val=1
                click btCoil1,0
            }
            // Load button state. Note: At the time of writing I didn't know that Nextion now supports bitwise operations.
            sys0=32
            sys1=TC_Settings.activeCoils.val
            if(sys1>=sys0)
            {
                btCoil6.val=1
                sys1-=sys0
            }
            sys0/=2
            if(sys1>=sys0)
            {
                btCoil5.val=1
                sys1-=sys0
            }
            sys0/=2
            if(sys1>=sys0)
            {
                btCoil4.val=1
                sys1-=sys0
            }
            sys0/=2
            if(sys1>=sys0)
            {
                btCoil3.val=1
                sys1-=sys0
            }
            sys0/=2
            if(sys1>=sys0)
            {
                btCoil2.val=1
                sys1-=sys0
            }
            sys0/=2
            if(sys1>=sys0)
            {
                btCoil1.val=1
                sys1-=sys0
            }
            // Load user's ontime and duty limit.
            if(User_Settings.userNum.val==2)
            {
                userOnLimit.val=User_Settings.u2Ontime.val
                userDutyLimit.val=User_Settings.u2Duty.val
            }else if(User_Settings.userNum.val==1)
            {
                userOnLimit.val=User_Settings.u1Ontime.val
                userDutyLimit.val=User_Settings.u1Duty.val
            }else
            {
                userOnLimit.val=User_Settings.u0Ontime.val
                userDutyLimit.val=User_Settings.u0Duty.val
            }
            // Load coil ontimes and assigned lightsabers Note: variables take much less space than displayed elements and are therefore better as persistent (= global) variables.
            nOn.val=ontime.val
            nOn2.val=ontimes12.val&0xffff
            nOn1.val=ontimes12.val>>16
            nOn1.val=nOn1.val&0xffff // Kill sign bit
            nOn4.val=ontimes34.val&0xffff
            nOn3.val=ontimes34.val>>16
            nOn3.val=nOn3.val&0xffff
            nOn6.val=ontimes56.val&0xffff
            nOn5.val=ontimes56.val>>16
            nOn3.val=nOn3.val&0xffff
            ls1.val=lightsabers.val&1
            lightsabers.val=lightsabers.val>>1
            ls2.val=lightsabers.val&1
            lightsabers.val=lightsabers.val>>1
            ls3.val=lightsabers.val&1
            lightsabers.val=lightsabers.val>>1
            ls4.val=lightsabers.val&1
            lightsabers.val=lightsabers.val>>1
            tLS1.txt=sLS1.txt
            tLS2.txt=sLS2.txt
            tLS3.txt=sLS3.txt
            tLS4.txt=sLS4.txt
            tLS5.txt=sLS5.txt
            tLS6.txt=sLS6.txt
            // Restore slider positions
            fSliderInput.val=sOn.maxval
            fSliderOutput.val=userOnLimit.val
            fSlider.val=nOn.val
            click fSlider,0
            sOn.val=fSlider.val
            // Tell the microcontroller: Mode: LightSaber
            prints "mls",3
            //
            // Load Help Mode
            vis qrHelp,Help_Info.helpMode.val
            tempStr.txt=tTitle.txt
            showHelp.val=1
            click 0,1
            //
            // Enable page refreshs again
            ref_star
        
        Postinitialize Event
            // Make sure the microcontroller is up-to-date
            click bApply,0
        
        Touch Press Event
            if(showHelp.val==0)
            {
                // Normal Operation
                if(Other_Settings.nBackOff.val!=0)
                {
                    // Default "stop" action.
                    // Send Mode Emergency Stop which turns all outputs off (but actually keeps the current mode)
                    prints "mes",3
                    // Set all ontime and duty settings of all pages to 0.
                    // First come the global variables then the local variables.
                    Simple.ontime.val=0
                    Simple.duty.val=0
                    Simple.set1.val=Simple.set1.val&0x0000ffff
                    Simple.set2.val=Simple.set2.val&0x0000ffff
                    Simple.set3.val=Simple.set3.val&0x0000ffff
                    Simple.set4.val=Simple.set4.val&0x0000ffff
                    Simple.set5.val=Simple.set5.val&0x0000ffff
                    Simple.set6.val=Simple.set6.val&0x0000ffff
                    MIDI_Live.ontime.val=0
                    MIDI_Live.duty.val=0
                    MIDI_Live.set1.val=0
                    MIDI_Live.set2.val=0
                    MIDI_Live.set3.val=0
                    MIDI_Live.set4.val=0
                    MIDI_Live.set5.val=0
                    MIDI_Live.set6.val=0
                    Lightsaber.ontime.val=0
                    Lightsaber.ontimes12.val=0
                    Lightsaber.ontimes34.val=0
                    Lightsaber.ontimes56.val=0
                    nOn.val=0
                    sOn.val=0
                    nOn1.val=0
                    nOn2.val=0
                    nOn3.val=0
                    nOn4.val=0
                    nOn5.val=0
                    nOn6.val=0
                }
            }else
            {
                // Show Help
                qrHelp.txt="git.io/Jkf2T"
                click qrHelp,0
            }
        
        Touch Release Event
            
        Page Exit Event
            // Store Ontime and Duty in global variables. Note: variables take much less space than displayed elements and are therefore better as persistent (= global) variables.
            ontime.val=nOn.val
            ontimes12.val=nOn1.val<<16
            ontimes12.val+=nOn2.val
            ontimes34.val=nOn3.val<<16
            ontimes34.val+=nOn4.val
            ontimes56.val=nOn5.val<<16
            ontimes56.val+=nOn6.val
            lightsabers.val=ls4.val
            lightsabers.val=lightsabers.val<<1
            lightsabers.val+=ls3.val
            lightsabers.val=lightsabers.val<<1
            lightsabers.val+=ls2.val
            lightsabers.val=lightsabers.val<<1
            lightsabers.val+=ls1.val
            sLS1.txt=tLS1.txt
            sLS2.txt=tLS2.txt
            sLS3.txt=tLS3.txt
            sLS4.txt=tLS4.txt
            sLS5.txt=tLS5.txt
            sLS6.txt=tLS6.txt
        
    Components
        Text tCoil
            Properties
                Scope       : Local
                Initial Text: "Apply to:"
                Max. length : 20
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tTitle
            Properties
                Scope       : Local
                Initial Text: "Lightsaber Mode"
                Max. length : 22
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Slider sOn
            Properties
                Scope           : Local
                Initial Position: 0
                Lower End       : 0
                Upper End       : 366
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        // Slider minval = 0
                        // Slider maxval = SliderWidth - CursorWIdth - 1
                        // => Slider resolution equals slider "pixel" resolution
                        fSliderInput.val=sOn.maxval
                        fSliderOutput.val=userOnLimit.val
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2m"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        fSlider.val=sOn.val
                        click fSlider,1
                        // Reduce resolution according to slider range for more "consistent" steps.
                        sys0=1
                        if(fSlider.val>=10000)
                        {
                            sys0=1000
                        }else if(fSlider.val>=5000)
                        {
                            sys0=500
                        }else if(fSlider.val>=1000)
                        {
                            sys0=100
                        }else if(fSlider.val>=500)
                        {
                            sys0=50
                        }else if(fSlider.val>=100)
                        {
                            sys0=10
                        }else if(fSlider.val>=50)
                        {
                            sys0=5
                        }
                        fSlider.val/=sys0
                        fSlider.val*=sys0
                        if(nOn.val!=fSlider.val)
                        {
                            newData.val=1
                            nOn.val=fSlider.val
                        }
                        // to understand the following lines have a look at the Touch Move code.
                        // what you would actually wanna do is put the code above in touch move and perform a click event on touch move here (because your can press/release a slider, changing its value without moving it).
                        // However "click" can only execute press/release events, so it gets more complicated...
                        if(sMode.txt==bModeRelease.txt)
                        {
                            click bApply,0
                        }
                        if(sMode.txt==bModeImmediate.txt)
                        {
                            click bApply,0
                        }
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
                Touch Move
                    // Prevent double data transmission on move.
                    sMode.txt+="M"
                    click sOn,0
                    sMode.txt-=1
                    if(sMode.txt==bModeImmediate.txt)
                    {
                        click bApply,0
                    }
                
        Number nOn
            Properties
                Scope        : Local
                Initial Value: 9999
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Button bReturn
            Properties
                Scope      : Local
                Caption    : "Return"
                Max. length: 10
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        // If button is hold, return without "exiting" MIDI Live mode (keep it running in background.
                        tmReturn.en=1
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2s"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        tmReturn.en=0
                        // Leaving MIDI Live Mode. Mode is now inactive
                        Settings.activeModes.val=Settings.activeModes.val^4
                        // Mode: EXit.
                        prints "mex",0
                        page Menu
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Text tUser
            Properties
                Scope       : Local
                Initial Text: " Guest"
                Max. length : 32
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Variable sMode
            Properties
                Scope         : Local
                Type          : String
                Initial String: "newtxt"
                Max. length   : 16
            
        Button bModeRelease
            Properties
                Scope      : Local
                Caption    : "On Release"
                Max. length: 15
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf23"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        vis bModeRelease,0
                        vis bModeManual,1
                        vis bApply,1
                        sMode.txt=bModeManual.txt
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Button bApply
            Properties
                Scope      : Local
                Caption    : "Apply now"
                Max. length: 15
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf23"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        // Return format: 'd', data byte 1, 2, 3, 4, 5
                        // Data byte 1:
                        //   Bit 0-5: Bitfield with coils to which the settings apply.
                        // Data byte 2: Command type.
                        //   Here: type 0: assigned lightsabers and ontime.
                        // Data byte 3: data1
                        //   Here: Bit 0-7: Bitfield with lightsabers to which the coils shall listen
                        // Data byte 4: lower data2 byte
                        // Data byte 5: upper data2 byte
                        //  Here: data2=ontime [us]
                        sys0=newData.val*TC_Settings.activeCoils.val
                        if(sys0>0)
                        {
                            // Update Info below coil buttons
                            tempString.txt=""
                            if(ls1.val==1)
                            {
                                tempString.txt+=ls1.txt
                            }else
                            {
                                tempString.txt+="_"
                            }
                            if(ls2.val==1)
                            {
                                tempString.txt+=ls2.txt
                            }else
                            {
                                tempString.txt+="_"
                            }
                            if(ls3.val==1)
                            {
                                tempString.txt+=ls3.txt
                            }else
                            {
                                tempString.txt+="_"
                            }
                            if(ls4.val==1)
                            {
                                tempString.txt+=ls4.txt
                            }else
                            {
                                tempString.txt+="_"
                            }
                            if(btCoil1.val==1)
                            {
                                nOn1.val=nOn.val
                                tLS1.txt=tempString.txt
                            }
                            if(btCoil2.val==1)
                            {
                                nOn2.val=nOn.val
                                tLS2.txt=tempString.txt
                            }
                            if(btCoil3.val==1)
                            {
                                nOn3.val=nOn.val
                                tLS3.txt=tempString.txt
                            }
                            if(btCoil4.val==1)
                            {
                                nOn4.val=nOn.val
                                tLS4.txt=tempString.txt
                            }
                            if(btCoil5.val==1)
                            {
                                nOn5.val=nOn.val
                                tLS5.txt=tempString.txt
                            }
                            if(btCoil6.val==1)
                            {
                                nOn6.val=nOn.val
                                tLS6.txt=tempString.txt
                            }
                            // sys1: active lightsabers
                            sys1=ls4.val
                            sys1=sys1<<1
                            sys1+=ls3.val
                            sys1=sys1<<1
                            sys1+=ls2.val
                            sys1=sys1<<1
                            sys1+=ls1.val
                            prints "d",0
                            prints sys0,1
                            prints 0,1
                            prints sys1,1
                            prints nOn.val,2
                            newData.val=0
                        }
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Button bModeImmediate
            Properties
                Scope      : Local
                Caption    : "Immediately"
                Max. length: 15
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf23"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        vis bModeImmediate,0
                        vis bModeRelease,1
                        sMode.txt=bModeRelease.txt
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Button bModeManual
            Properties
                Scope      : Local
                Caption    : "Manually"
                Max. length: 15
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf23"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        vis bApply,0
                        vis bModeManual,0
                        vis bModeImmediate,1
                        sMode.txt=bModeImmediate.txt
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Text tus
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Dual-state Button btCoil1
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "1"
                Max. length  : 3
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        // A coil might have been enabled, and thus does not have the currently displayed values.
                        newData.val=1
                        //  Bit 0-5 correspond to the state of the buttons btCoil1-btCoil6
                        sys0=btCoil1.val
                        sys0=btCoil2.val*2+sys0
                        sys0=btCoil3.val*4+sys0
                        sys0=btCoil4.val*8+sys0
                        sys0=btCoil5.val*16+sys0
                        sys0=btCoil6.val*32+sys0
                        // Store settings
                        TC_Settings.activeCoils.val=sys0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button btCoil2
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "2"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click btCoil1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button btCoil3
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "3"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click btCoil1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button btCoil4
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "4"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click btCoil1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button btCoil5
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "5"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click btCoil1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button btCoil6
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "6"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2O"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click btCoil1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Timer tmLSButtonHold
            Properties
                Scope      : Local
                Period [ms]: 250
                Running    : No
            
            Events
                Touch Press Event
                    p
                    e
                
                Touch Release Event
                    p
                    e
                
        Variable lsID
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable newData
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable sVolMode
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable ontime
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 0
            
        Variable lightsabers
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 255
            
        Variable openEE
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable ontimes12
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 0
            
        Variable ontimes34
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 0
            
        Variable ontimes56
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 0
            
        Variable sLS1
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Variable sLS2
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Variable sLS3
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Number fSlider
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // fXxxx are functions. Since they need to be clicked to execute their code they need to be on the same page. Usage:
                    // 1. set the component value (fXxx.val) to the input value
                    // 2. Execute code with "click fXxxx,1".
                    // 3. Read the result from the component value (fXxx.val)
                    //
                    // Touch Press: g = o * f(x / i) with f(x) = (x^2 + x) / 2, i: input range, o: output range. => g = (x^2 + i * x) * o / (2 * i^2)
                    // Touch Release: g^-1 = ( sqrt( ( x * 8 + o ) * o ) - o ) * i / ( 2 * o )
                    //
                    sys0=fSlider.val
                    fSlider.val=sys0*sys0
                    sys0*=fSliderInput.val
                    fSlider.val+=sys0
                    fSlider.val*=fSliderOutput.val
                    sys0=2*fSliderInput.val*fSliderInput.val
                    fSlider.val/=sys0
                
                Touch Release Event
                    // fXxxx are functions. Since they need to be clicked to execute their code they need to be on the same page. Usage:
                    // 1. set the component value (fXxx.val) to the input value
                    // 2. Execute code with "click fXxxx,1".
                    // 3. Read the result from the component value (fXxx.val)
                    //
                    // Touch Press: g = o * f(x / i) with f(x) = (x^2 + x) / 2, i: input range, o: output range. => g = (x^2 + i * x) * o / (2 * i^2)
                    // Touch Release: g^-1 = ( sqrt( ( x * 8 + o ) * o ) - o ) * i / ( 2 * o )
                    //
                    fSqrt.val=fSlider.val*8
                    fSqrt.val+=fSliderOutput.val
                    fSqrt.val*=fSliderOutput.val
                    click fSqrt,1
                    fSqrt.val-=fSliderOutput.val
                    fSqrt.val*=fSliderInput.val
                    sys0=2*fSliderOutput.val
                    fSlider.val=fSqrt.val/sys0
                
        Variable fSliderInput
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable fSliderOutput
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable userOnLimit
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Variable userDutyLimit
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Number fSqrt
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // fXxxx are functions. Since they need to be clicked to execute their code they need to be on the same page. Usage:
                    // 1. set the component value (fXxx.val) to the input value
                    // 2. Execute code with "click fXxxx,1".
                    // 3. Read the result from the component value (fXxx.val)
                    // This functions calculates the square root. Source: https://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Binary_numeral_system_(base_2)
                    sys0=0
                    sys1=1
                    while(sys1<=fSqrt.val)
                    {
                        sys1=sys1<<2
                    }
                    sys1=sys1>>2
                    while(sys1!=0)
                    {
                        sys2=sys0+sys1
                        if(fSqrt.val>=sys2)
                        {
                            fSqrt.val-=sys2
                            sys0=sys0>>1
                            sys0+=sys1
                        }else
                        {
                            sys0=sys0>>1
                        }
                        sys1=sys1>>2
                    }
                    fSqrt.val=sys0
                
                Touch Release Event
                    
        Text tOn
            Properties
                Scope       : Local
                Initial Text: "Ontime:"
                Max. length : 20
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Timer tmReturn
            Properties
                Scope      : Local
                Period [ms]: 250
                Running    : No
            
            Events
                Touch Press Event
                    p
                    e
                
                Touch Release Event
                    p
                    e
                
        Text tMML
            Properties
                Scope       : Local
                Initial Text: "MIDI Live"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tMSI
            Properties
                Scope       : Local
                Initial Text: "Simple"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn1
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus1
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn2
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus2
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn3
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus3
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn4
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus4
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn5
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus5
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nOn6
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tus6
            Properties
                Scope       : Local
                Initial Text: "탎"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLightsabers
            Properties
                Scope       : Local
                Initial Text: "Lightsabers:"
                Max. length : 20
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Dual-state Button ls1
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "1"
                Max. length  : 3
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        lsID.val=1
                        newData.val=1
                        tmLSButtonHold.en=1
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2Y"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        tmLSButtonHold.en=0
                        if(sMode.txt==bModeRelease.txt||sMode.txt==bModeImmediate.txt)
                        {
                            click bApply,0
                        }
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button ls2
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "2"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        lsID.val=2
                        newData.val=1
                        tmLSButtonHold.en=1
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2Y"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click ls1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button ls3
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "3"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        lsID.val=3
                        newData.val=1
                        tmLSButtonHold.en=1
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2Y"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click ls1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Dual-state Button ls4
            Properties
                Scope        : Local
                Initial State: 0
                Caption      : "4"
                Max. length  : 4
            
            Events
                Touch Press Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        lsID.val=4
                        newData.val=1
                        tmLSButtonHold.en=1
                    }else
                    {
                        // Show Help
                        qrHelp.txt="git.io/Jkf2Y"
                    }
                
                Touch Release Event
                    if(showHelp.val==0)
                    {
                        // Normal Operation
                        click ls1,0
                    }else
                    {
                        // Show Help
                        click qrHelp,0
                    }
                
        Text tLSInfo
            Properties
                Scope       : Local
                Initial Text: "Hold to set ID of the\r\nconnected ESP8266."
                Max. length : 100
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tMLS
            Properties
                Scope       : Local
                Initial Text: "Lightsaber"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Variable tempString
            Properties
                Scope         : Local
                Type          : String
                Initial String: ""
                Max. length   : 4
            
        Text tLS1
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLS2
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLS4
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLS3
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLS6
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tLS5
            Properties
                Scope       : Local
                Initial Text: "____"
                Max. length : 8
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Variable sLS4
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Variable sLS5
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Variable sLS6
            Properties
                Scope         : Global
                Type          : String
                Initial String: "1234"
                Max. length   : 4
            
        Variable tempStr
            Properties
                Scope         : Local
                Type          : String
                Initial String: ""
                Max. length   : 32
            
        Variable showHelp
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        QRCode qrHelp
            Events
                Touch Press Event
                    
                Touch Release Event
                    ref_stop
                    if(showHelp.val==0)
                    {
                        showHelp.val=1
                        tempStr.txt=tTitle.txt
                        tTitle.txt="Get Help for..."
                    }else
                    {
                        showHelp.val=0
                        tTitle.txt=tempStr.txt
                    }
                    vis qrHelp,Help_Info.helpMode.val
                    ref_star
                
        Hotspot fLoadColors
            Events
                Touch Press Event
                    // Changes all page components according to the current color set.
                    // Note: This component has to be the last component of the page.
                    //
                    // sys0: component id
                    // sys1: component type
                    // sys2: picture id offset for current color mode
                    sys2=Settings.colorMode.val*Settings.picCount.val
                    for(sys0=0;sys0<fLoadColors.id;sys0++)
                    {
                        // More convenient for typing
                        sys1=b[sys0].type
                        if(sys1==121)
                        {
                            // Types that have bco
                            // page
                            if(b[sys0].bco!=Settings.backCol2.val)
                            {
                                b[sys0].bco=Settings.backCol.val
                            }
                        }else if(sys1==54||sys1==59||sys1==116||sys1==55)
                        {
                            // Types that have bco, pco, and sta:
                            // number, float, text, scroll text
                            if(b[sys0].sta==1)
                            {
                                if(b[sys0].bco!=Settings.backCol2.val)
                                {
                                    b[sys0].bco=Settings.backCol.val
                                    b[sys0].pco=Settings.frontCol.val
                                }else
                                {
                                    b[sys0].pco=Settings.frontCol2.val
                                }
                            }
                        }else if(sys1==98||sys1==53)
                        {
                            // Types that have pco, pic, pco2, pic2, sta:
                            // button, dual-state button
                            if(b[sys0].sta==2)
                            {
                                b[sys0].pco=Settings.frontCol.val
                                b[sys0].pco2=Settings.backCol.val
                                b[sys0].pic=b[sys0].pic%Settings.picCount.val
                                b[sys0].pic+=sys2
                                b[sys0].pic2=b[sys0].pic+1
                            }
                        }else if(sys1==58)
                        {
                            // Types that have bco, pco
                            // QR Code
                            b[sys0].bco=Settings.backCol.val
                            b[sys0].pco=Settings.qrFrontCol.val
                        }else if(sys1==1)
                        {
                            // Types that have pic, pic2:
                            // slider
                            b[sys0].pic=b[sys0].pic%Settings.picCount.val
                            b[sys0].pic+=sys2
                            b[sys0].pic2=b[sys0].pic2%Settings.picCount.val
                            b[sys0].pic2+=sys2
                        }
                    }
                
                Touch Release Event
                    
