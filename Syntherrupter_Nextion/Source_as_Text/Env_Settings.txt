Page Env_Settings
    Events
        Preinitialize Event
            // Prevent page refreshs until postinit
            ref_stop
            //
            // Load colors
            click fLoadColors,1
            //
            // Display username
            if(User_Settings.userNum.val==0)
            {
                tUser.txt=" "+User_Settings.u0Name.txt
            }else if(User_Settings.userNum.val==1)
            {
                tUser.txt=" "+User_Settings.u1Name.txt
            }else if(User_Settings.userNum.val==2)
            {
                tUser.txt=" "+User_Settings.u2Name.txt
            }
            sys0=Settings.activeModes.val&4
            if(sys0!=0)
            {
                // Lightsaber Mode is active
                tMLS.bco=6900
            }
            //
            // Display all active modes
            sys0=Settings.activeModes.val&1
            if(sys0!=0)
            {
                // Simple Mode is active
                tMSI.bco=6900
            }
            sys0=Settings.activeModes.val&2
            if(sys0!=0)
            {
                // MIDI Live Mode is active
                tMML.bco=6900
            }
            // Display maxSteps
            nMaxSteps1.val=maxSteps.val
            nMaxSteps2.val=maxSteps.val
            //
            // Idle field is just used for default text/background color and as target for the numpad if no component is selected. Ergo should be hidden like functions.
            vis idle,0
            vis fCheck,0
            //
            // Set newValTargetId to idle
            newValTargetId.val=idle.id
            // First step is step 0, which cant be release
            vis tRelease1,0
            vis tRelease2,0
            // Currently no dedicated Write EEPROM Button is needed.
            vis bSaveEEPROM,0
            //
            // Enable page refreshs again
            ref_star
        
        Postinitialize Event
            
        Touch Press Event
            if(Other_Settings.nBackOff.val!=0)
            {
                // Default "stop" action.
                // Send Mode Emergency Stop which turns all outputs off (but actually keeps the current mode)
                prints "mes",3
                // Set all ontime and duty settings of all pages to 0.
                // First come the global variables then the local variables.
                Simple.ontime.val=0
                Simple.duty.val=0
                Simple.set1.val=Simple.set1.val&0x0000ffff
                Simple.set2.val=Simple.set2.val&0x0000ffff
                Simple.set3.val=Simple.set3.val&0x0000ffff
                Simple.set4.val=Simple.set4.val&0x0000ffff
                Simple.set5.val=Simple.set5.val&0x0000ffff
                Simple.set6.val=Simple.set6.val&0x0000ffff
                MIDI_Live.ontime.val=0
                MIDI_Live.duty.val=0
                MIDI_Live.set1.val=0
                MIDI_Live.set2.val=0
                MIDI_Live.set3.val=0
                MIDI_Live.set4.val=0
                MIDI_Live.set5.val=0
                MIDI_Live.set6.val=0
                Lightsaber.ontime.val=0
                Lightsaber.ontimes12.val=0
                Lightsaber.ontimes34.val=0
                Lightsaber.ontimes56.val=0
            }
        
        Touch Release Event
            
        Page Exit Event
            
    Components
        Text tTitle
            Properties
                Scope       : Local
                Initial Text: "Envelope Settings"
                Max. length : 30
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tUser
            Properties
                Scope       : Local
                Initial Text: " Guest"
                Max. length : 32
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tMSI
            Properties
                Scope       : Local
                Initial Text: "Simple"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tMML
            Properties
                Scope       : Local
                Initial Text: "MIDI Live"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tMLS
            Properties
                Scope       : Local
                Initial Text: "Lightsaber"
                Max. length : 16
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tHideBack2
            Properties
                Scope       : Local
                Initial Text: " "
                Max. length : 1
            
            Events
                Touch Press Event
                    // This is just to hide the background around the sliders so that you do not turn the outputs off by accident.
                
                Touch Release Event
                    
        Button b0
            Properties
                Scope      : Local
                Caption    : "0"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    click fCheck,0
                
        Button b1
            Properties
                Scope      : Local
                Caption    : "1"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=1
                    }else
                    {
                        b[newValTargetId.val].val+=1
                    }
                    click fCheck,0
                
        Button b2
            Properties
                Scope      : Local
                Caption    : "2"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=2
                    }else
                    {
                        b[newValTargetId.val].val+=2
                    }
                    click fCheck,0
                
        Button b3
            Properties
                Scope      : Local
                Caption    : "3"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=3
                    }else
                    {
                        b[newValTargetId.val].val+=3
                    }
                    click fCheck,0
                
        Button b4
            Properties
                Scope      : Local
                Caption    : "4"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=4
                    }else
                    {
                        b[newValTargetId.val].val+=4
                    }
                    click fCheck,0
                
        Button b5
            Properties
                Scope      : Local
                Caption    : "5"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=5
                    }else
                    {
                        b[newValTargetId.val].val+=5
                    }
                    click fCheck,0
                
        Button b6
            Properties
                Scope      : Local
                Caption    : "6"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=6
                    }else
                    {
                        b[newValTargetId.val].val+=6
                    }
                    click fCheck,0
                
        Button b7
            Properties
                Scope      : Local
                Caption    : "7"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=7
                    }else
                    {
                        b[newValTargetId.val].val+=7
                    }
                    click fCheck,0
                
        Button b8
            Properties
                Scope      : Local
                Caption    : "8"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=8
                    }else
                    {
                        b[newValTargetId.val].val+=8
                    }
                    click fCheck,0
                
        Button b9
            Properties
                Scope      : Local
                Caption    : "9"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    if(newSelect.val!=0)
                    {
                        newSelect.val=0
                        b[newValTargetId.val].val=0
                    }else
                    {
                        b[newValTargetId.val].val*=10
                    }
                    if(b[newValTargetId.val].val<0)
                    {
                        b[newValTargetId.val].val-=9
                    }else
                    {
                        b[newValTargetId.val].val+=9
                    }
                    click fCheck,0
                
        Button bClear
            Properties
                Scope      : Local
                Caption    : "X"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    //if(newValTargetId.val==nProg.id||newValTargetId.val==nStep.id)
                    //{
                    //  b[newValTargetId.val].val=1
                    //}else
                    //{
                    b[newValTargetId.val].val=0
                    //}
                    //click fCheck,0
                
        Button bSet
            Properties
                Scope      : Local
                Caption    : "Set Values"
                Max. length: 20
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    click bOK,0
                    //
                    // Serial Data format: 'd', Data Byte 1, 2, 3, 4, 5
                    // Data byte 1:
                    //    Bit 6-7: 3 = ADSR settings.
                    //    Bit 0-5: 0: Update EEPROM. 1-63: ADSR Program which will be modified.
                    // Data byte 2: Parameter that is set.
                    //    0: Set current step (byte 3 ignored, should be 0) (Like NRP number)
                    //    1: Set next step (byte 3 ignored, should be 0)
                    //    2: Set amplitude
                    //    3: Set duration in milliseconds
                    //    4: Set n-tau.
                    // Data Byte 3:
                    //   Bit 0-6: Power of 10 by which the value (bytes 4-5) is divided.
                    //   Bit 7: 0: Value is positive. 1: Value is negative.
                    // Data Byte 4: Value, LSB
                    // Data Byte 5: Value, MSB
                    //
                    // Send all changes
                    changedValues.val=0x1f
                    sys1=0
                    while(sys1>=0)
                    {
                        // sys1 contains Data Byte 2
                        // See fCheck to see how changedValues is set.
                        sys1=1
                        sys1=sys1&changedValues.val
                        if(sys1>0)
                        {
                            changedValues.val-=sys1
                            sys1=0
                        }else
                        {
                            sys1=1<<1
                            sys1=sys1&changedValues.val
                            if(sys1>0)
                            {
                                changedValues.val-=sys1
                                sys1=1
                            }else
                            {
                                sys1=1<<2
                                sys1=sys1&changedValues.val
                                if(sys1>0)
                                {
                                    changedValues.val-=sys1
                                    sys1=2
                                }else
                                {
                                    sys1=1<<3
                                    sys1=sys1&changedValues.val
                                    if(sys1>0)
                                    {
                                        changedValues.val-=sys1
                                        sys1=3
                                    }else
                                    {
                                        sys1=1<<4
                                        sys1=sys1&changedValues.val
                                        if(sys1>0)
                                        {
                                            changedValues.val-=sys1
                                            sys1=4
                                        }else
                                        {
                                            sys1=1<<5
                                            sys1=sys1&changedValues.val
                                            if(sys1>0)
                                            {
                                                changedValues.val-=sys1
                                                sys1=5
                                            }else
                                            {
                                                sys1=-1
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        if(sys1>=0)
                        {
                            // sys2 contains Data Byte 3-5
                            sys2=0
                            if(sys1==0)
                            {
                                sys2=nStep.val-1
                                sys0=nStep.id
                            }else if(sys1==1)
                            {
                                sys2=nNext.val-1
                                sys0=nNext.id
                            }else if(sys1==2)
                            {
                                sys2=nAmp.val
                                sys0=nAmp.id
                            }else if(sys1==3)
                            {
                                sys2=nDur.val
                                sys0=nDur.id
                            }else if(sys1==4)
                            {
                                sys2=nNTau.val
                                sys0=nNTau.id
                            }
                            if(sys2<0)
                            {
                                // We want the absolute value (same bits for positive and negative value)...
                                sys2=0-sys2
                                // ... and indicate the sign with a sign bit only.
                                sys2=sys2<<1
                                sys2+=1
                            }else
                            {
                                // Only do the bitshifting (sign bit remains 0)
                                sys2=sys2<<1
                            }
                            sys2=sys2<<7
                            if(b[sys0].type==59)
                            {
                                sys2+=b[sys0].vvs1
                            }
                            //
                            // sys0 contains Data Byte 1
                            sys0=3<<6
                            sys0+=nProg.val
                            prints "d",1
                            prints sys0,1
                            prints sys1,1
                            prints sys2,3
                        }
                    }
                
        Text tStep
            Properties
                Scope       : Local
                Initial Text: "Step"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tAmp
            Properties
                Scope       : Local
                Initial Text: "Amplitude"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tDur
            Properties
                Scope       : Local
                Initial Text: "Duration"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tNTau
            Properties
                Scope       : Local
                Initial Text: "n-tau"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nStep
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nStep.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Text tms
            Properties
                Scope       : Local
                Initial Text: "ms"
                Max. length : 2
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Float nNTau
            Properties
                Scope           : Local
                Initial Value   : 0
                Divide by [10^x]: 1
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nNTau.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Button bReturn
            Properties
                Scope      : Local
                Caption    : "Return"
                Max. length: 10
            
            Events
                Touch Press Event
                    click bSaveEEPROM,0
                
                Touch Release Event
                    page Settings
                
        Number nDur
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nDur.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Float nAmp
            Properties
                Scope           : Local
                Initial Value   : 0
                Divide by [10^x]: 1
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nAmp.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Button b10
            Properties
                Scope      : Local
                Caption    : "±"
                Max. length: 1
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    b[newValTargetId.val].val*=-1
                    click fCheck,0
                
        Button bL
            Properties
                Scope      : Local
                Caption    : "«"
                Max. length: 2
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    newSelect.val=0
                    if(b[newValTargetId.val].type==59)
                    {
                        // If selected component has a decimal point, move it.
                        b[newValTargetId.val].vvs1+=1
                    }else
                    {
                        // If selected component is a normal number, decrement it.
                        b[newValTargetId.val].val-=1
                    }
                    click fCheck,0
                
        Button bR
            Properties
                Scope      : Local
                Caption    : "»"
                Max. length: 2
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    newSelect.val=0
                    if(b[newValTargetId.val].type==59)
                    {
                        // If selected component has a decimal point.
                        if(b[newValTargetId.val].vvs1>0)
                        {
                            b[newValTargetId.val].vvs1-=1
                        }
                    }else
                    {
                        // If selected component is a normal number, increment it.
                        b[newValTargetId.val].val+=1
                    }
                    click fCheck,0
                
        Variable newValTargetId
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 68
            
        Variable newSelect
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Float idle
            Properties
                Scope           : Local
                Initial Value   : 0
                Divide by [10^x]: 0
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    
        Text fCheck
            Properties
                Scope       : Local
                Initial Text: " "
                Max. length : 10
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    // Settings must stay in certain ranges. this function checks and fixes them.
                    // Okay on this page this event does some more voodoo.
                    if(b[newValTargetId.val].type==59)
                    {
                        // If selected component has a decimal point.
                        bL.txt="«"
                        bR.txt="»"
                    }else
                    {
                        bL.txt="-1"
                        bR.txt="+1"
                    }
                    // ifs can only compare variables, they cannot do calulations...
                    sys0=63+1
                    if(nProg.val==0)
                    {
                        nProg.val=63
                    }else if(nProg.val==sys0)
                    {
                        nProg.val=1
                    }else if(nProg.val>sys0)
                    {
                        nProg.val=63
                    }else if(nProg.val<1)
                    {
                        nProg.val=1
                    }
                    // ifs can only compare variables, they cannot do calulations...
                    sys0=maxSteps.val+1
                    if(nStep.val==0)
                    {
                        nStep.val=maxSteps.val
                    }else if(nStep.val==sys0)
                    {
                        nStep.val=1
                    }else if(nStep.val>sys0)
                    {
                        nStep.val=maxSteps.val
                    }else if(nStep.val<1)
                    {
                        nStep.val=1
                    }
                    // ifs can only compare variables, they cannot do calulations...
                    sys0=maxSteps.val+1
                    if(nNext.val==0)
                    {
                        nNext.val=maxSteps.val
                    }else if(nNext.val==sys0)
                    {
                        nNext.val=1
                    }else if(nNext.val>sys0)
                    {
                        nNext.val=maxSteps.val
                    }else if(nNext.val<1)
                    {
                        nNext.val=1
                    }
                    if(nStep.val==maxSteps.val)
                    {
                        nNext.val=maxSteps.val
                        nAmp.val=0
                        vis tRelease1,1
                    }else
                    {
                        vis tRelease1,0
                    }
                    if(nNext.val==maxSteps.val)
                    {
                        vis tRelease2,1
                    }else
                    {
                        vis tRelease2,0
                    }
                    if(nAmp.val<0)
                    {
                        nAmp.val=0
                    }
                    if(nDur.val<0)
                    {
                        nDur.val=0
                    }
                    if(newSelect.val==0)
                    {
                        //
                        // Mark field as modified
                        sys0=0
                        if(newValTargetId.val==nProg.id)
                        {
                            sys0=0x1f
                        }
                        if(newValTargetId.val==nStep.id)
                        {
                            sys0=1
                        }else if(newValTargetId.val==nNext.id)
                        {
                            sys0=1<<1
                        }else if(newValTargetId.val==nAmp.id)
                        {
                            sys0=1<<2
                        }else if(newValTargetId.val==nDur.id)
                        {
                            sys0=1<<3
                        }else if(newValTargetId.val==nNTau.id)
                        {
                            sys0=1<<4
                        }
                        changedValues.val|=sys0
                    }
                
        Variable maxSteps
            Properties
                Scope         : Global
                Type          : int32
                Initial Value : 4
            
        Text tRelease1
            Properties
                Scope       : Local
                Initial Text: "(Release)"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nMaxSteps1
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nStep.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check if values are legal
                    click fCheck,0
                
                Touch Release Event
                    
        Text tSlash1
            Properties
                Scope       : Local
                Initial Text: "/"
                Max. length : 1
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tNextStep
            Properties
                Scope       : Local
                Initial Text: "Next Step"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nNext
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nNext.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Button bSaveEEPROM
            Properties
                Scope      : Local
                Caption    : "Write EEPROM"
                Max. length: 30
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    click fCheck,0
                    //
                    // Serial Data format: 'd', Data Byte 1, 2, 3, 4, 5
                    // Data byte 1:
                    //    Bit 6-7: 3 = ADSR settings.
                    //    Bit 0-5: 0: Update EEPROM. 1-63: ADSR Program which will be modified.
                    // Data byte 2: Parameter that is set.
                    //    0: Set current step (byte 3 ignored, should be 0) (Like NRP number)
                    //    1: Set next step (byte 3 ignored, should be 0)
                    //    2: Set amplitude
                    //    3: Set duration in milliseconds
                    //    4: Set n-tau.
                    // Data Byte 3:
                    //   Bit 0-6: Power of 10 by which the value (bytes 4-5) is divided.
                    //   Bit 7: 0: Value is positive. 1: Value is negative.
                    // Data Byte 4: Value, LSB
                    // Data Byte 5: Value, MSB
                    //
                    // sys0 contains Data Byte 1
                    sys0=3<<6
                    prints "d",1
                    prints sys0,1
                    prints 0,4
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    newValTargetId.val=idle.id
                
        Text tProg
            Properties
                Scope       : Local
                Initial Text: "Program"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Number nProg
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nProg.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check values
                    click fCheck,0
                
                Touch Release Event
                    
        Button bOK
            Properties
                Scope      : Local
                Caption    : "ok"
                Max. length: 2
            
            Events
                Touch Press Event
                    
                Touch Release Event
                    click fCheck,0
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    newValTargetId.val=idle.id
                
        Variable changedValues
            Properties
                Scope         : Local
                Type          : int32
                Initial Value : 0
            
        Number nMaxSteps2
            Properties
                Scope        : Local
                Initial Value: 0
            
            Events
                Touch Press Event
                    // Reset push state of last selected value
                    b[newValTargetId.val].bco=idle.bco
                    b[newValTargetId.val].pco=idle.pco
                    // Mark this field as pushed
                    newValTargetId.val=nStep.id
                    b[newValTargetId.val].bco=idle.pco
                    b[newValTargetId.val].pco=idle.bco
                    // A new value has been selected
                    newSelect.val=1
                    // Check if values are legal
                    click fCheck,0
                
                Touch Release Event
                    
        Text tSlash2
            Properties
                Scope       : Local
                Initial Text: "/"
                Max. length : 1
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Text tRelease2
            Properties
                Scope       : Local
                Initial Text: "(Release)"
                Max. length : 15
            
            Events
                Touch Press Event
                    // Make this object "transparent" for clicks and click background.
                    click 0,1
                
                Touch Release Event
                    
        Hotspot fLoadColors
            Events
                Touch Press Event
                    // Changes all page components according to the current color set.
                    // Note: This component has to be the last component of the page.
                    //
                    // sys0: component id
                    // sys1: component type
                    // sys2: picture id offset for current color mode
                    sys2=Settings.colorMode.val*Settings.picCount.val
                    for(sys0=0;sys0<fLoadColors.id;sys0++)
                    {
                        // More convenient for typing
                        sys1=b[sys0].type
                        if(sys1==121)
                        {
                            // Types that have bco
                            // page
                            if(b[sys0].bco!=Settings.backCol2.val)
                            {
                                b[sys0].bco=Settings.backCol.val
                            }
                        }else if(sys1==54||sys1==59||sys1==116||sys1==55)
                        {
                            // Types that have bco, pco, and sta:
                            // number, float, text, scroll text
                            if(b[sys0].sta==1)
                            {
                                if(b[sys0].bco!=Settings.backCol2.val)
                                {
                                    b[sys0].bco=Settings.backCol.val
                                    b[sys0].pco=Settings.frontCol.val
                                }else
                                {
                                    b[sys0].pco=Settings.frontCol2.val
                                }
                            }
                        }else if(sys1==98||sys1==53)
                        {
                            // Types that have pco, pic, pco2, pic2, sta:
                            // button, dual-state button
                            if(b[sys0].sta==2)
                            {
                                b[sys0].pco=Settings.frontCol.val
                                b[sys0].pco2=Settings.backCol.val
                                b[sys0].pic=b[sys0].pic%Settings.picCount.val
                                b[sys0].pic+=sys2
                                b[sys0].pic2=b[sys0].pic+1
                            }
                        }else if(sys1==1)
                        {
                            // Types that have pic, pic2:
                            // slider
                            b[sys0].pic=b[sys0].pic%Settings.picCount.val
                            b[sys0].pic+=sys2
                            b[sys0].pic2=b[sys0].pic2%Settings.picCount.val
                            b[sys0].pic2+=sys2
                        }
                    }
                
                Touch Release Event
                    
